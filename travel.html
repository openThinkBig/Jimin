<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>travel</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

    <style>
        .map_wrap {position:relative;width:40%;height:600px;left:280px;}
        #clickAddr, #defaultAddr {display:block;margin-top:-8px;font-weight: normal;}
        .bAddr {padding:5px;text-overflow: ellipsis;overflow: hidden;white-space: nowrap;}
        #part1 {position:absolute;left:930px;top:80px;display:none}
        #part2 {position:absolute;left:920px;top:80px;}
        .pic_line {position:relative;margin-top: 10px;}
        #chooseFile {visibility: hidden;}
        .fileInput {visibility: hidden;}
        #image-show {position:absolute;margin-top:-280px;width:200px;height:240px;margin-left:180px}
    </style>
</head>
    <body>
        <div id="total">
            <div>
                <h2 style="position:relative;left:280px;">Travel</h2>
                <button id="add" style="position:absolute;left:1400px;top:30px;display:inline;">add</button>
            </div>
            <div class="map_wrap">
                <div id="map" style="width:100%;height:100%;position:relative;overflow:hidden;"></div>
            </div>
            <div id="part1">
                <label for="tit" style="position:relative;">Title: </label>
                <input type="text" id="tit" style="position:relative;">
                <input type="submit" style="left:240px;position:relative;" value="store">
                <form method="post" enctype="multipart/form-data">
                    <label for="chooseFile">
                    <img src="Nature landscape.jpg" style="width:200px;height:150px;display:block;left:180px;top:20px;position:relative;">
                    </label>
                    <input type="file" id="chooseFile" name="chooseFile" accept="image/*" onchange="loadFile(this)">
                </form>
                <div class="fileInput">
                    <p>FILE NAME: </p>
                    <p id="fileName"></p>
                </div>
                <div id="image-show"></div>
                <textarea style="width:500px;height:370px;top:20px;position:relative"></textarea>
            </div>
            <div id="part2">
                <span id="clickAddr"></span>
                <span id="defaultAddr">서울특별시 중구 명동</span>
                <div class="pic_line">
                    <img src="Nature landscape.jpg" style="width:150px;height:100px;">
                    <img src="Nature landscape.jpg" style="width:150px;height:100px;">
                    <img src="Nature landscape.jpg" style="width:150px;height:100px;">
                </div>
                <div class="pic_line">
                    <img src="Nature landscape.jpg" style="width:150px;height:100px;">
                    <img src="Nature landscape.jpg" style="width:150px;height:100px;">
                    <img src="Nature landscape.jpg" style="width:150px;height:100px;">
                </div>
            </div>
        </div>

        <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=c10bcbe1d13946345e9b5271c7587340&libraries=services"></script>
        <script>
        var mapContainer = document.getElementById('map'), // 지도를 표시할 div 
            mapOption = {
                center: new kakao.maps.LatLng(37.566826, 126.9786567), // 지도의 중심좌표
                level: 14 // 지도의 확대 레벨
            };  

        // 지도를 생성합니다    
        var map = new kakao.maps.Map(mapContainer, mapOption); 

        // 주소-좌표 변환 객체를 생성합니다
        var geocoder = new kakao.maps.services.Geocoder();

        var marker = new kakao.maps.Marker(), // 클릭한 위치를 표시할 마커입니다
        infowindow = new kakao.maps.InfoWindow({zindex:1}); // 클릭한 위치에 대한 주소를 표시할 인포윈도우입니다

        const add_element = document.getElementById("add"); // add 버튼이 클릭했을 때 이벤트를 등록시키기 위해 사용하는 변수입니다
        var part_1 = document.getElementById("part1"); // add 버튼이 클릭됐을 때 출력될 div를 위해 사용하는 변수입니다

        // add 버튼을 누른 뒤 지도를 클릭했을 때 클릭 위치 좌표에 대한 주소정보를 표시하도록 이벤트를 등록합니다
        add_element.addEventListener("click", function(){
            kakao.maps.event.addListener(map, 'click', function(mouseEvent) {
            searchDetailAddrFromCoords(mouseEvent.latLng, function(result, status) {

                if (status === kakao.maps.services.Status.OK) {
                    part_1.style.display = "block";
                    $("#part2").hide();
                    var detailAddr = !!result[0].road_address ? '<div>도로명주소 : ' + result[0].road_address.address_name + '</div>' : '';
                    detailAddr += '<div>지번 주소 : ' + result[0].address.address_name + '</div>';
                    
                    var content = '<div class="bAddr">' +
                                    detailAddr + 
                                '</div>';

                    // 마커를 클릭한 위치에 표시합니다 
                    marker.setPosition(mouseEvent.latLng);
                    marker.setMap(map);

                    // 인포윈도우에 클릭한 위치에 대한 법정동 상세 주소정보를 표시합니다
                    infowindow.setContent(content);
                    infowindow.open(map, marker);
                }   
            });
            });
        });

        // 지도를 클릭했을 시 클릭되는 행정동 위치 정보를 넣습니다
        kakao.maps.event.addListener(map, 'click', function(mouseEvent) {
        searchAddrFromCoords(mouseEvent.latLng, function(result, status) {
            if (status === kakao.maps.services.Status.OK) {
                $("#defaultAddr").hide();

                var infoDiv = document.getElementById('clickAddr');

                for(var i = 0; i < result.length; i++) {
                    // 행정동의 region_type 값은 'H' 이므로
                    if (result[i].region_type === 'H') {
                        infoDiv.innerHTML = result[i].address_name;
                        break;
                    }
                }
            }   
            });
        });

        function searchAddrFromCoords(coords, callback) {
            // 좌표로 행정동 주소 정보를 요청합니다
            geocoder.coord2RegionCode(coords.getLng(), coords.getLat(), callback);         
        }

        function searchDetailAddrFromCoords(coords, callback) {
            // 좌표로 법정동 상세 주소 정보를 요청합니다
            geocoder.coord2Address(coords.getLng(), coords.getLat(), callback);
        }

        function loadFile(input) {
            var file = input.files[0];	//선택된 파일 가져오기

            //미리 만들어 놓은 div에 text(파일 이름) 추가
            var name = document.getElementById('fileName');
            name.textContent = file.name;

            //새로운 이미지 div 추가
            var newImage = document.createElement("img");
            newImage.setAttribute("class", 'img');

            //이미지 source 가져오기
            newImage.src = URL.createObjectURL(file);   

            newImage.style.width = "100%";
            newImage.style.height = "100%";
            newImage.style.objectFit = "contain";

            //이미지를 image-show div에 추가
            var container = document.getElementById('image-show');
            container.appendChild(newImage);

            var newImage_prt = document.getElementById('image-show').lastElementChild;
  
            //이미지는 화면에 나타나고
            newImage_prt.style.visibility = "visible";
        };

        </script>
    </body>
</html>